<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebAR - Piłka między punktami</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/jeromeetienne/AR.js/aframe/build/aframe-ar.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body style="margin: 0; overflow: hidden;">
  <a-scene embedded arjs>
    <!-- Marker AR -->
    <a-marker preset="hiro" id="marker">
      <!-- Piłka -->
      <a-sphere position="0 0.5 0" radius="0.1" color="red" id="ball" visible="false"></a-sphere>
    </a-marker>

    <!-- Kamera -->
    <a-entity camera></a-entity>
  </a-scene>

  <script>
    let ball = document.querySelector("#ball");
    let marker = document.querySelector("#marker");
    let points = [];

    // Funkcja dodająca punkty po kliknięciu
    window.addEventListener("click", function(event) {
      if (points.length < 2) {
        // Obliczamy współrzędne w przestrzeni 3D na podstawie kliknięcia w oknie
        let cursor = document.querySelector('a-cursor'); // Wskaźnik kursora
        let position = cursor.getAttribute('position');  // Pobierz pozycję kursora w przestrzeni AR
        
        // Dodaj punkt na podstawie współrzędnych kursora
        points.push(position);
        
        if (points.length === 2) {
          ball.setAttribute("visible", "true");
          moveBall();
        }
      }
    });

    // Funkcja przesuwająca piłkę między punktami
    function moveBall() {
      let start = points[0];
      let end = points[1];
      let duration = 2; // Czas trwania animacji w sekundach
      let startTime = null;

      function animate(time) {
        if (!startTime) startTime = time;
        let progress = (time - startTime) / (duration * 1000);
        if (progress < 1) {
          let x = start.x + (end.x - start.x) * progress;
          let y = start.y + (end.y - start.y) * progress;
          let z = start.z + (end.z - start.z) * progress;
          ball.setAttribute("position", `${x} ${y} ${z}`);
          requestAnimationFrame(animate);
        } else {
          ball.setAttribute("position", `${end.x} ${end.y} ${end.z}`);
        }
      }

      requestAnimationFrame(animate);
    }
  </script>
</body>
</html>
